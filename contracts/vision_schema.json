{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://hasharita/contracts/vision_schema.json",
  "title": "HasHarita Vision Segmentation API Contract",
  "$defs": {
    "Bounds4326": {
      "type": "array",
      "description": "[minLon, minLat, maxLon, maxLat] in EPSG:4326",
      "items": { "type": "number" },
      "prefixItems": [
        { "type": "number", "minimum": -180, "maximum": 180 },
        { "type": "number", "minimum": -90, "maximum": 90 },
        { "type": "number", "minimum": -180, "maximum": 180 },
        { "type": "number", "minimum": -90, "maximum": 90 }
      ],
      "minItems": 4,
      "maxItems": 4
    },
    "SegClass": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": {
          "type": "string",
          "enum": ["collapsed_building", "flooded_area", "burned_area"]
        },
        "area_px": { "type": "integer", "minimum": 0 },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 }
      },
      "required": ["name", "area_px", "confidence"]
    },
    "VisionSegmentRequest": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tile_id": { "type": "string" },
        "image_uri": { "type": "string", "minLength": 1 },
        "bounds": { "$ref": "#/$defs/Bounds4326" },
        "epsg": { "type": "integer", "const": 4326 }
      },
      "required": ["tile_id", "image_uri", "bounds", "epsg"],
      "examples": [
        {
          "tile_id": "tile_0001",
          "image_uri": "/data/raster/tile_0001.tif",
          "bounds": [28.95, 41.02, 28.98, 41.05],
          "epsg": 4326
        }
      ]
    },
    "VisionSegmentResponse": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "tile_id": { "type": "string" },
        "mask_uri": { "type": "string", "minLength": 1 },
        "classes": {
          "type": "array",
          "items": { "$ref": "#/$defs/SegClass" },
          "maxItems": 10
        }
      },
      "required": ["tile_id", "mask_uri", "classes"],
      "examples": [
        {
          "tile_id": "tile_0001",
          "mask_uri": "/artifacts/masks/tile_0001.png",
          "classes": [
            { "name": "flooded_area", "area_px": 9321, "confidence": 0.78 }
          ]
        }
      ]
    }
  },
  "description": "Use #/$defs/VisionSegmentRequest for request validation and #/$defs/VisionSegmentResponse for response validation."
}
